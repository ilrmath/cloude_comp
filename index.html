<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>IaaS / PaaS / SaaS è¦–è¦šãƒ‡ãƒ¢</title>
  <style>
    :root {
      --bg: #020617;
      --panel: #020617;
      --border: #1f2937;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --user: #4f46e5;
      --provider: #f97316;
      --accent: #22c55e;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 16px;
      min-height: 100vh;
      background: radial-gradient(circle at top, #111827, #020617);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .app {
      max-width: 980px;
      width: 100%;
    }

    h1 {
      margin: 0;
      font-size: 24px;
    }

    .subtitle {
      margin-top: 4px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .mode-buttons {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .mode-btn {
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      padding: 6px 14px;
      font-size: 13px;
      color: var(--text-sub);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
    }

    .mode-btn span {
      font-size: 11px;
      opacity: 0.85;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: transparent;
      color: #f9fafb;
      box-shadow: 0 8px 20px rgba(34,197,94,0.5);
      transform: translateY(-1px);
    }

    .legend-row {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-box {
      width: 14px;
      height: 14px;
      border-radius: 4px;
    }

    .legend-box.user {
      background: var(--user);
    }

    .legend-box.provider {
      background: var(--provider);
    }

    .layout {
      margin-top: 18px;
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: linear-gradient(145deg, #020617, #020617, #111827);
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      padding: 14px;
    }

    /* å·¦ï¼šè¨­å®šã‚¨ãƒªã‚¢ */

    .config-title {
      font-size: 14px;
      margin-bottom: 10px;
    }

    .config-row {
      margin-bottom: 10px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .config-row label {
      display: block;
      margin-bottom: 4px;
    }

    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: var(--text-main);
      font-size: 12px;
      outline: none;
    }

    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.4);
    }

    .run-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .run-btn {
      border-radius: 999px;
      border: none;
      padding: 7px 18px;
      font-size: 13px;
      cursor: pointer;
      color: #f9fafb;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 8px 20px rgba(34,197,94,0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .run-btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(34,197,94,0.5);
    }

    .run-hint {
      font-size: 11px;
      color: var(--text-sub);
    }

    /* å³ï¼šã‚¯ãƒ©ã‚¦ãƒ‰ç©ã¿æœ¨ï¼‹PC */

    .cloud-title {
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      color: var(--text-sub);
    }

    .cloud-title-sub {
      margin-top: 2px;
      font-size: 10px;
      color: var(--text-sub);
    }

    .cloud-title span:last-child {
      font-size: 18px;
    }

    .cloud-inner {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 12px;
      align-items: center;
    }

    @media (max-width: 720px) {
      .cloud-inner {
        grid-template-columns: 1fr;
      }
    }

    .stack-box {
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 8px;
    }

    .stack {
      display: flex;
      flex-direction: column-reverse;
      gap: 8px;
    }

    .stack-layer {
      border-radius: 10px;
      padding: 6px 8px;
      background: #020617;
      border: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      transform-origin: left center;
      position: relative;
      overflow: hidden;
      color: #e5e7eb;
    }

    .stack-layer .label-main {
      font-weight: 600;
    }

    .stack-layer .label-sub {
      font-size: 10px;
      color: var(--text-sub);
    }

    .layer-role {
      font-size: 10px;
      font-weight: 600;
    }

    .user-part {
      background: linear-gradient(135deg, rgba(79,70,229,0.85), rgba(79,70,229,0.45));
      border-color: rgba(129,140,248,0.95);
      box-shadow: 0 8px 18px rgba(79,70,229,0.5);
    }

    .provider-part {
      background: linear-gradient(135deg, rgba(249,115,22,0.9), rgba(249,115,22,0.5));
      border-color: rgba(251,146,60,0.95);
      box-shadow: 0 8px 18px rgba(249,115,22,0.5);
    }

    .build {
      animation: build 0.35s ease-out;
    }

    @keyframes build {
      0%   { transform: translateY(6px) scale(0.94); opacity: 0; }
      70%  { transform: translateY(-2px) scale(1.02); opacity: 1; }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }

    /* PCã®è¦‹ãŸç›® */

    .pc-box {
      display: flex;
      justify-content: center;
    }

    .pc-frame {
      width: 100%;
      max-width: 360px;
      background: #020617;
      border-radius: 14px 14px 8px 8px;
      border: 1px solid #1f2937;
      padding: 6px 8px 10px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    }

    .pc-screen {
      border-radius: 10px;
      height: 170px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      font-size: 11px;
      color: #e5e7eb;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.8);
      position: relative;
      overflow: hidden;
    }

    .pc-screen.iaas {
      background: radial-gradient(circle at top, #020617, #000000);
    }
    .pc-screen.paas {
      background: radial-gradient(circle at top, #0ea5e9, #1e293b);
    }
    .pc-screen.saas {
      background: radial-gradient(circle at top, #22c55e, #14532d);
    }

    /* IaaS ãƒ—ãƒ©ãƒ³ã”ã¨ã®è¦‹ãŸç›® */
    .pc-screen.iaas-small {
      background: radial-gradient(circle at top, #0f172a, #020617);
      box-shadow:
        0 0 0 1px rgba(148,163,184,0.8),
        inset 0 0 0 1px rgba(15,23,42,0.9);
    }

    .pc-screen.iaas-medium {
      background: radial-gradient(circle at top, #22c55e, #022c22);
      box-shadow:
        0 0 0 1px rgba(34,197,94,0.9),
        inset 0 0 0 1px rgba(15,23,42,0.9);
    }

    .pc-screen.iaas-large {
      background: radial-gradient(circle at top, #f97316, #7c2d12);
      box-shadow:
        0 0 0 1px rgba(249,115,22,0.95),
        inset 0 0 0 1px rgba(15,23,42,0.9);
    }

    .pc-screen.run {
      animation: pulse 0.5s ease-out;
    }

    @keyframes pulse {
      0% { transform: scale(0.97); box-shadow: 0 0 0 rgba(34,197,94,0); }
      60% { transform: scale(1.02); box-shadow: 0 0 18px rgba(34,197,94,0.8); }
      100% { transform: scale(1); box-shadow: 0 0 4px rgba(34,197,94,0.5); }
    }

    .screen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      margin-bottom: 4px;
    }

    .screen-header-left {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .dots {
      display: flex;
      gap: 3px;
    }
    .dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
    }

    .screen-body {
      flex: 1;
      border-radius: 8px;
      background: rgba(15,23,42,0.8);
      padding: 6px;
      overflow: hidden;
    }

    .pc-base {
      margin-top: 6px;
      height: 10px;
      border-radius: 0 0 10px 10px;
      background: linear-gradient(to bottom, #020617, #0b1220);
      position: relative;
    }

    .pc-base::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 2px;
      width: 60px;
      height: 3px;
      border-radius: 999px;
      background: #111827;
      transform: translateX(-50%);
    }

    .pc-caption {
      margin-top: 4px;
      font-size: 10px;
      text-align: center;
      color: var(--text-sub);
    }

    /* ã‚¢ãƒ—ãƒªUIé¢¨ */

    /* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«(IaaS) */
    .console {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 10px;
      color: #e5e7eb;
    }
    .console-line {
      white-space: nowrap;
    }
    .cursor {
      display: inline-block;
      width: 6px;
      height: 10px;
      background: #e5e7eb;
      margin-left: 2px;
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.01%, 100% { opacity: 0; }
    }

    /* ãƒ¡ãƒ¼ãƒ« */
    .mail-app {
      display: grid;
      grid-template-columns: 0.9fr 1.4fr;
      gap: 4px;
      height: 100%;
    }
    .mail-list {
      background: rgba(15,23,42,0.9);
      border-radius: 6px;
      padding: 4px;
    }
    .mail-item {
      font-size: 9px;
      padding: 2px 3px;
      border-radius: 4px;
      margin-bottom: 2px;
      background: rgba(15,23,42,0.9);
      display: flex;
      justify-content: space-between;
      gap: 4px;
    }
    .mail-item.unread {
      background: rgba(34,197,94,0.2);
      font-weight: 600;
    }
    .mail-item span {
      white-space: nowrap;
    }
    .mail-body {
      background: rgba(15,23,42,0.9);
      border-radius: 6px;
      padding: 4px;
      font-size: 9px;
    }
    .mail-subject {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .mail-meta {
      font-size: 8px;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    /* æˆç¸¾è¡¨ */
    .grade-app {
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 9px;
      color: #e5e7eb;
    }
    .grade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .grade-table {
      border-radius: 5px;
      overflow: hidden;
      border: 1px solid #1f2937;
    }
    .grade-row {
      display: grid;
      grid-template-columns: 1.4fr 0.6fr 0.6fr 0.6fr;
    }
    .grade-cell {
      padding: 2px 4px;
      border-bottom: 1px solid #1f2937;
      border-right: 1px solid #1f2937;
      white-space: nowrap;
    }
    .grade-row.header {
      background: rgba(15,23,42,0.95);
      font-weight: 600;
    }
    .grade-row:nth-child(2n+1):not(.header) {
      background: rgba(15,23,42,0.8);
    }

    /* ãƒãƒ£ãƒƒãƒˆ */
    .chat-app {
      display: flex;
      flex-direction: column;
      height: 100%;
      font-size: 9px;
    }
    .chat-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .bubble-row {
      display: flex;
    }
    .bubble {
      max-width: 70%;
      padding: 3px 6px;
      border-radius: 10px;
    }
    .bubble.me {
      margin-left: auto;
      background: #22c55e;
      color: #022c22;
      border-bottom-right-radius: 2px;
    }
    .bubble.other {
      margin-right: auto;
      background: #0f172a;
      border-bottom-left-radius: 2px;
    }
    .chat-input-bar {
      margin-top: 4px;
      height: 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      position: relative;
      overflow: hidden;
    }
    .chat-input-bar::after {
      content: "";
      position: absolute;
      left: 6px;
      top: 2px;
      width: 40%;
      height: 5px;
      border-radius: 999px;
      background: rgba(148,163,184,0.7);
    }

    /* ãƒ–ãƒ­ã‚° */
    .blog-app {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 9px;
    }
    .blog-item {
      padding: 2px 3px;
      border-radius: 4px;
      background: rgba(15,23,42,0.9);
    }
    .blog-title {
      font-weight: 600;
    }
    .blog-meta {
      font-size: 8px;
      color: var(--text-sub);
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>ã‚¯ãƒ©ã‚¦ãƒ‰ï¼šIaaS / PaaS / SaaS</h1>
    <div class="subtitle">
      ãƒ»ä¸Šã§ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€€ãƒ»å·¦ã§é¸ã‚“ã§ã€€ãƒ»ã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã§èµ·å‹•ï¼ã€ã§å³ã®PCç”»é¢ãŒå¤‰ã‚ã‚‹
    </div>

    <div class="mode-buttons">
      <button class="mode-btn active" data-mode="iaas">
        IaaS
        <span>è³‡æºã ã‘</span>
      </button>
      <button class="mode-btn" data-mode="paas">
        PaaS
        <span>OSï¼‹ã‚¢ãƒ—ãƒª</span>
      </button>
      <button class="mode-btn" data-mode="saas">
        SaaS
        <span>ã‚¢ãƒ—ãƒªã ã‘</span>
      </button>
    </div>

    <div class="legend-row">
      <div class="legend-item">
        <div class="legend-box user"></div> é’ï¼šã‚ãªãŸ
      </div>
      <div class="legend-item">
        <div class="legend-box provider"></div> ã‚ªãƒ¬ãƒ³ã‚¸ï¼šã‚¯ãƒ©ã‚¦ãƒ‰
      </div>
    </div>

    <div class="layout">
      <!-- å·¦ï¼šè¨­å®š -->
      <div class="panel">
        <div class="config-title" id="configTitle">IaaSï¼šè³‡æºãƒ—ãƒ©ãƒ³ã‚’é¸ã¶</div>

        <!-- IaaS -->
        <div class="config-row" data-for="iaas">
          <label for="iaasResource">ã‚µãƒ¼ãƒãƒ¼è³‡æºï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰</label>
          <select id="iaasResource">
            <option value="small">å°ï¼š2 vCPU / 4GB</option>
            <option value="medium" selected>ä¸­ï¼š4 vCPU / 8GB</option>
            <option value="large">å¤§ï¼š8 vCPU / 16GB</option>
          </select>
        </div>

        <!-- PaaS -->
        <div class="config-row" data-for="paas" style="display:none;">
          <label for="paasOs">OSãƒ»ãƒ©ãƒ³ã‚¿ã‚¤ãƒ </label>
          <select id="paasOs">
            <option value="node" selected>Linux + Node.js</option>
            <option value="python">Linux + Python</option>
            <option value="dotnet">Windows + .NET</option>
          </select>
        </div>
        <div class="config-row" data-for="paas" style="display:none;">
          <label for="paasApp">ç½®ãã‚¢ãƒ—ãƒª</label>
          <select id="paasApp">
            <option value="grade" selected>æˆç¸¾ç®¡ç†ã‚¢ãƒ—ãƒª</option>
            <option value="blog">å­¦æ ¡ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒª</option>
            <option value="chat">æ ¡å†…ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</option>
          </select>
        </div>

        <!-- SaaS -->
        <div class="config-row" data-for="saas" style="display:none;">
          <label for="saasApp">ä½¿ã†ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ—ãƒª</label>
          <select id="saasApp">
            <option value="gradeSaaS" selected>ã‚¯ãƒ©ã‚¦ãƒ‰æˆç¸¾ç®¡ç†</option>
            <option value="mailSaaS">ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¼ãƒ«</option>
            <option value="chatSaaS">ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒ£ãƒƒãƒˆ</option>
          </select>
        </div>

        <div class="run-row">
          <button class="run-btn" id="runBtn">â˜ï¸ ã‚¯ãƒ©ã‚¦ãƒ‰ã§èµ·å‹•ï¼</button>
          <div class="run-hint" id="runHint">IaaSï¼šè³‡æºã ã‘ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å€Ÿã‚Šã‚‹</div>
        </div>
      </div>

      <!-- å³ï¼šã‚¯ãƒ©ã‚¦ãƒ‰ç©ã¿æœ¨ï¼‹PC -->
      <div class="panel">
        <div class="cloud-title">
          <div>
            <span>ã‚¯ãƒ©ã‚¦ãƒ‰ã®ä¸­</span>
            <div class="cloud-title-sub" id="modeFullName"></div>
          </div>
          <span>â˜ï¸</span>
        </div>
        <div class="cloud-inner">
          <!-- ç©ã¿æœ¨ -->
          <div class="stack-box">
            <div class="stack" id="stack">
              <div class="stack-layer" data-id="hw">
                <div>
                  <div class="label-main">è³‡æº</div>
                  <div class="label-sub" id="hwSub">CPU / ãƒ¡ãƒ¢ãƒª</div>
                </div>
                <div class="layer-role"></div>
              </div>
              <div class="stack-layer" data-id="os">
                <div>
                  <div class="label-main">OSãƒ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢</div>
                  <div class="label-sub" id="osSub">Linux / DB ãªã©</div>
                </div>
                <div class="layer-role"></div>
              </div>
              <div class="stack-layer" data-id="app">
                <div>
                  <div class="label-main">ã‚¢ãƒ—ãƒª</div>
                  <div class="label-sub" id="appSub">æˆç¸¾ / ãƒ¡ãƒ¼ãƒ« / ãƒãƒ£ãƒƒãƒˆ</div>
                </div>
                <div class="layer-role"></div>
              </div>
              <div class="stack-layer" data-id="data">
                <div>
                  <div class="label-main">ãƒ‡ãƒ¼ã‚¿</div>
                  <div class="label-sub" id="dataSub">æˆç¸¾ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
                </div>
                <div class="layer-role"></div>
              </div>
            </div>
          </div>

          <!-- PC -->
          <div>
            <div class="pc-box">
              <div class="pc-frame">
                <div class="pc-screen iaas iaas-medium" id="pcScreen">
                  <div class="screen-header">
                    <div class="screen-header-left">
                      <div class="dots">
                        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                      </div>
                      <span id="screenTitle">VM ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</span>
                    </div>
                    <span id="screenModeLabel">IaaS</span>
                  </div>
                  <div class="screen-body" id="screenBody">
                    <!-- JSã§æç”» -->
                  </div>
                </div>
                <div class="pc-base"></div>
              </div>
            </div>
            <div class="pc-caption">ã“ã®PCç”»é¢ã®ä¸­èº«ã¯ã€Œã‚¯ãƒ©ã‚¦ãƒ‰å´ã€ã§å‹•ã„ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const ownership = {
      iaas: { user: ["os", "app", "data"], provider: ["hw"] },
      paas: { user: ["app", "data"], provider: ["hw", "os"] },
      saas: { user: ["data"], provider: ["hw", "os", "app"] }
    };

    const modeTexts = {
      iaas: {
        configTitle: "IaaSï¼šè³‡æºãƒ—ãƒ©ãƒ³ã‚’é¸ã¶",
        hint: "IaaSï¼šè³‡æºã ã‘ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å€Ÿã‚Šã‚‹",
        screenMode: "IaaS",
        fullName: "IaaS = Infrastructure as a Service"
      },
      paas: {
        configTitle: "PaaSï¼šOSã¨ã‚¢ãƒ—ãƒªã‚’é¸ã¶",
        hint: "PaaSï¼šåœŸå°ï¼‹ã‚¢ãƒ—ãƒªã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã§å‹•ã‹ã™",
        screenMode: "PaaS",
        fullName: "PaaS = Platform as a Service"
      },
      saas: {
        configTitle: "SaaSï¼šã‚¢ãƒ—ãƒªã ã‘é¸ã¶",
        hint: "SaaSï¼šå‡ºæ¥ä¸ŠãŒã£ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’ãã®ã¾ã¾ä½¿ã†",
        screenMode: "SaaS",
        fullName: "SaaS = Software as a Service"
      }
    };

    let currentMode = "iaas";
    let bootCount = 0; // ã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã§èµ·å‹•ï¼ã€ã—ãŸå›æ•°

    const stackEl      = document.getElementById("stack");
    const configTitleEl= document.getElementById("configTitle");
    const runHintEl    = document.getElementById("runHint");
    const hwSubEl      = document.getElementById("hwSub");
    const osSubEl      = document.getElementById("osSub");
    const appSubEl     = document.getElementById("appSub");

    const iaasResourceEl = document.getElementById("iaasResource");
    const paasOsEl       = document.getElementById("paasOs");
    const paasAppEl      = document.getElementById("paasApp");
    const saasAppEl      = document.getElementById("saasApp");

    const pcScreenEl   = document.getElementById("pcScreen");
    const screenTitleEl= document.getElementById("screenTitle");
    const screenModeLabelEl = document.getElementById("screenModeLabel");
    const screenBodyEl = document.getElementById("screenBody");
    const modeFullNameEl = document.getElementById("modeFullName");

    const buttons   = document.querySelectorAll(".mode-btn");
    const configRows= document.querySelectorAll(".config-row");

    function updateOwnership(mode) {
      const userSet = new Set(ownership[mode].user);
      const layers = stackEl.querySelectorAll(".stack-layer");

      layers.forEach(layer => {
        const id = layer.dataset.id;
        const isUser = userSet.has(id);
        layer.classList.remove("user-part", "provider-part", "build");
        void layer.offsetWidth; // ã‚¢ãƒ‹ãƒ¡å†å§‹å‹•
        if (isUser) {
          layer.classList.add("user-part", "build");
          layer.querySelector(".layer-role").textContent = "ã‚ãªãŸ";
        } else {
          layer.classList.add("provider-part", "build");
          layer.querySelector(".layer-role").textContent = "ã‚¯ãƒ©ã‚¦ãƒ‰";
        }
      });
    }

    function appKindFromValue(v) {
      if (v === "grade" || v === "gradeSaaS") return "grade";
      if (v === "blog") return "blog";
      if (v === "chat" || v === "chatSaaS") return "chat";
      if (v === "mailSaaS") return "mail";
      return "grade";
    }

    function renderConsole(planVal, planText) {
      const count = bootCount;
      let cpuBar, memBar, desc;

      if (planVal === "small") {
        cpuBar = "â–®â–®â–¡â–¡â–¡â–¡â–¡â–¡";
        memBar = "â–®â–®â–®â–¡â–¡â–¡â–¡â–¡";
        desc   = "å°ã•ã‚ï¼šãƒ†ã‚¹ãƒˆãƒ»å°è¦æ¨¡ã‚µã‚¤ãƒˆå‘ã‘";
      } else if (planVal === "large") {
        cpuBar = "â–®â–®â–®â–®â–®â–®â–®â–®";
        memBar = "â–®â–®â–®â–®â–®â–®â–®â–®";
        desc   = "å¤§ãã‚ï¼šã‚¢ã‚¯ã‚»ã‚¹å¤šã‚ã®æœ¬ç•ªå‘ã‘";
      } else { // medium
        cpuBar = "â–®â–®â–®â–®â–¡â–¡â–¡";
        memBar = "â–®â–®â–®â–®â–®â–¡â–¡";
        desc   = "ä¸­ãã‚‰ã„ï¼šãµã¤ã†ã®æˆæ¥­ç”¨ã‚µãƒ¼ãƒ“ã‚¹å‘ã‘";
      }

      screenTitleEl.textContent = "VM ã‚³ãƒ³ã‚½ãƒ¼ãƒ«";
      screenBodyEl.innerHTML =
        `<div class="console">
          <div class="console-line">&gt; èµ·å‹•å›æ•°: ${count}</div>
          <div class="console-line">&gt; VM ãƒ—ãƒ©ãƒ³: ${planText}</div>
          <div class="console-line">&gt; èª¬æ˜: ${desc}</div>
          <div class="console-line">&gt; CPU [${cpuBar}]</div>
          <div class="console-line">&gt; MEM [${memBar}]</div>
          <div class="console-line">&gt; OS: æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</div>
          <div class="console-line">&gt; ã‚¢ãƒ—ãƒª: æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</div>
          <div class="console-line">&gt; å¾…æ©Ÿä¸­...<span class="cursor"></span></div>
        </div>`;
    }

    function renderMailUI() {
      screenTitleEl.textContent = "ãƒ¡ãƒ¼ãƒ« - å—ä¿¡ãƒˆãƒ¬ã‚¤";
      screenBodyEl.innerHTML = `
        <div class="mail-app">
          <div class="mail-list">
            <div class="mail-item unread">
              <span>ã€æˆç¸¾ã€‘1å¹´A çµæœå…¥åŠ›</span><span>ä»Šæœ</span>
            </div>
            <div class="mail-item">
              <span>æ•™å‹™éƒ¨ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›</span><span>æ˜¨æ—¥</span>
            </div>
            <div class="mail-item">
              <span>è·å“¡ä¼šè­° è­°äº‹éŒ²</span><span>å…ˆé€±</span>
            </div>
          </div>
          <div class="mail-body">
            <div class="mail-subject">ã€æˆç¸¾ã€‘1å¹´A çµæœå…¥åŠ›ã®ãŠé¡˜ã„</div>
            <div class="mail-meta">æ•™å‹™éƒ¨ | èµ·å‹• #${bootCount}</div>
            <div>1å­¦æœŸæœŸæœ«ã®æˆç¸¾ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>
          </div>
        </div>
      `;
    }

    function renderGradeUI(titleSuffix) {
      screenTitleEl.textContent = "æˆç¸¾ç®¡ç† " + titleSuffix;
      screenBodyEl.innerHTML = `
        <div class="grade-app">
          <div class="grade-header">
            <span>1å¹´A çµæœä¸€è¦§</span>
            <span>æ•°å­¦I | èµ·å‹• #${bootCount}</span>
          </div>
          <div class="grade-table">
            <div class="grade-row header">
              <div class="grade-cell">æ°å</div>
              <div class="grade-cell">ä¸­é–“</div>
              <div class="grade-cell">æœŸæœ«</div>
              <div class="grade-cell">è©•å®š</div>
            </div>
            <div class="grade-row">
              <div class="grade-cell">å±±ç”°</div>
              <div class="grade-cell">78</div>
              <div class="grade-cell">82</div>
              <div class="grade-cell">4</div>
            </div>
            <div class="grade-row">
              <div class="grade-cell">ä½è—¤</div>
              <div class="grade-cell">92</div>
              <div class="grade-cell">88</div>
              <div class="grade-cell">5</div>
            </div>
            <div class="grade-row">
              <div class="grade-cell">éˆ´æœ¨</div>
              <div class="grade-cell">65</div>
              <div class="grade-cell">71</div>
              <div class="grade-cell">3</div>
            </div>
          </div>
        </div>
      `;
    }

    function renderChatUI() {
      screenTitleEl.textContent = "æ ¡å†…ãƒãƒ£ãƒƒãƒˆ";
      screenBodyEl.innerHTML = `
        <div class="chat-app">
          <div class="chat-body">
            <div class="bubble-row">
              <div class="bubble other">ã‚¯ãƒ©ã‚¦ãƒ‰æˆç¸¾ã‚·ã‚¹ãƒ†ãƒ ã€èµ·å‹• #${bootCount} ã¾ã§ç¢ºèªã—ã¾ã—ãŸã€‚</div>
            </div>
            <div class="bubble-row">
              <div class="bubble me">OKã€æˆæ¥­ã§ã‚‚ã“ã®ç”»é¢ã‚’è¦‹ã›ã¦èª¬æ˜ã—ã¾ã™ã€‚</div>
            </div>
            <div class="bubble-row">
              <div class="bubble other">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ğŸ™</div>
            </div>
          </div>
          <div class="chat-input-bar"></div>
        </div>
      `;
    }

    function renderBlogUI() {
      screenTitleEl.textContent = "å­¦æ ¡ãƒ–ãƒ­ã‚°";
      screenBodyEl.innerHTML = `
        <div class="blog-app">
          <div class="blog-item">
            <div class="blog-title">ã‚¯ãƒ©ã‚¦ãƒ‰ã§æˆç¸¾ç®¡ç†é–‹å§‹ (èµ·å‹• #${bootCount})</div>
            <div class="blog-meta">æ•™å‹™éƒ¨ Â· æœ¬æ—¥</div>
            <div>æ–°ã—ã„ã‚¯ãƒ©ã‚¦ãƒ‰æˆç¸¾ã‚·ã‚¹ãƒ†ãƒ ã®é‹ç”¨ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚</div>
          </div>
          <div class="blog-item">
            <div class="blog-title">æƒ…å ±ã®æˆæ¥­ã§ã‚¯ãƒ©ã‚¦ãƒ‰ä½“é¨“</div>
            <div class="blog-meta">æƒ…å ±ç§‘ Â· æ˜¨æ—¥</div>
            <div>ç”Ÿå¾’ãŒ IaaS / PaaS / SaaS ã‚’æ“ä½œã—ãªãŒã‚‰å­¦ã³ã¾ã—ãŸã€‚</div>
          </div>
        </div>
      `;
    }

    function updateStackLabels() {
      if (currentMode === "iaas") {
        const planText = iaasResourceEl.options[iaasResourceEl.selectedIndex].textContent;
        hwSubEl.textContent = planText;
        osSubEl.textContent = "OS / DB ã‚’è‡ªåˆ†ã§ç”¨æ„";
        appSubEl.textContent = "ã‚¢ãƒ—ãƒªã‚’è‡ªåˆ†ã§ä½œæˆ";
      } else if (currentMode === "paas") {
        const osText  = paasOsEl.options[paasOsEl.selectedIndex].textContent;
        const appText = paasAppEl.options[paasAppEl.selectedIndex].textContent;
        hwSubEl.textContent = "ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒãƒ¼ãƒ‰ï¼ˆè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰";
        osSubEl.textContent = osText + "ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ç®¡ç†ï¼‰";
        appSubEl.textContent = appText + "ï¼ˆè‡ªåˆ†ã§é…ç½®ï¼‰";
      } else if (currentMode === "saas") {
        const saasText = saasAppEl.options[saasAppEl.selectedIndex].textContent;
        hwSubEl.textContent = "ã‚¯ãƒ©ã‚¦ãƒ‰äº‹æ¥­è€…ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼";
        osSubEl.textContent = "OS / DB ãªã©å…¨éƒ¨ã‚¯ãƒ©ã‚¦ãƒ‰";
        appSubEl.textContent = saasText + " æœ¬ä½“";
      }
    }

    function updateScreen(fromRun) {
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆ
      pcScreenEl.classList.remove(
        "iaas","paas","saas",
        "iaas-small","iaas-medium","iaas-large",
        "run"
      );
      void pcScreenEl.offsetWidth; // ã‚¢ãƒ‹ãƒ¡å†å§‹å‹•

      const text = modeTexts[currentMode];
      screenModeLabelEl.textContent = text.screenMode;

      if (modeFullNameEl && text.fullName) {
        modeFullNameEl.textContent = text.fullName;
      }

      updateStackLabels();

      if (currentMode === "iaas") {
        const planVal  = iaasResourceEl.value; // small / medium / large
        const planText = iaasResourceEl.options[iaasResourceEl.selectedIndex].textContent;
        pcScreenEl.classList.add("iaas", `iaas-${planVal}`);
        renderConsole(planVal, planText);
      } else if (currentMode === "paas") {
        pcScreenEl.classList.add("paas");
        const appVal = paasAppEl.value;
        const kind = appKindFromValue(appVal);
        if (kind === "grade") renderGradeUI("(PaaS)");
        else if (kind === "blog") renderBlogUI();
        else if (kind === "chat") renderChatUI();
      } else if (currentMode === "saas") {
        pcScreenEl.classList.add("saas");
        const appVal = saasAppEl.value;
        const kind = appKindFromValue(appVal);
        if (kind === "grade") renderGradeUI("(SaaS)");
        else if (kind === "mail") renderMailUI();
        else if (kind === "chat") renderChatUI();
      }

      if (fromRun) {
        pcScreenEl.classList.add("run");
      }
    }

    function switchMode(mode) {
      currentMode = mode;

      // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
      buttons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });

      // è¨­å®šè¡¨ç¤º
      configRows.forEach(row => {
        const forMode = row.getAttribute("data-for");
        if (!forMode) return;
        row.style.display = (forMode === mode) ? "block" : "none";
      });

      // ãƒ†ã‚­ã‚¹ãƒˆ
      const t = modeTexts[mode];
      configTitleEl.textContent = t.configTitle;
      runHintEl.textContent     = t.hint;

      // ç©ã¿æœ¨ã®è‰²
      updateOwnership(mode);

      // ç”»é¢æ›´æ–°
      updateScreen(false);
    }

    // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        switchMode(btn.dataset.mode);
      });
    });

    // ã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã§èµ·å‹•ï¼ã€ãƒœã‚¿ãƒ³
    document.getElementById("runBtn").addEventListener("click", () => {
      bootCount++;
      updateScreen(true);
    });

    // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¤‰æ›´æ™‚ã‚‚å³åæ˜ 
    iaasResourceEl.addEventListener("change", () => updateScreen(false));
    paasOsEl.addEventListener("change", () => updateScreen(false));
    paasAppEl.addEventListener("change", () => updateScreen(false));
    saasAppEl.addEventListener("change", () => updateScreen(false));

    // åˆæœŸè¡¨ç¤º
    switchMode("iaas");
  </script>
</body>
</html>
